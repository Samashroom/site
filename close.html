---
layout: quest
title: Квест
noindex: true
---
<div id="quest-container">
    <div style="
        display: flex;
        justify-content: center;
        align-items: center;">
        <img id="quest-image" src="" alt="Свободное место">
    </div>
    <div id="quest-text">Загрузка...</div>
    <div id="interaction-area"></div>
</div>

<script>
    // ОБЪЕКТ КВЕСТА - ВСЯ ЛОГИКА ЗДЕСЬ
    const questData = {
        "start": {
            image: "{{ '/assets/princel/1.png' | relative_url }}",
            text: "...",
            type: "continue",
            next: "01"
        },
        "01": {
            image: "{{ '/assets/princel/1.png' | relative_url }}",
            text: ".......",
            type: "choice",
            choices: [
                { text: "Хей!", next: "02" },
                { text: "...", next: "01" }
            ]
        },
        "02": {
            image: "{{ '/assets/princel/5.png' | relative_url }}",
            text: "!!!",
            type: "continue",
            next: "03"
        },
        "03": {
            image: "{{ '/assets/princel/3.png' | relative_url }}",
            text: "Я думал, тут никого не будет",
            type: "continue", // Убрал дублирование type
            next: "04"
        },
        "04": { 
            image: "{{ '/assets/princel/4.png' | relative_url }}",
            text: "Отстань",
            type: "continue",
            next: "05"
        },
        "05": {
            image: "{{ '/assets/princel/4.png' | relative_url }}",
            text: "...",
            type: "input",
            answer: "кря",
            correctNext: "success",
            wrongNext: "wrong"
        },
        "wrong": {
            image: "{{ '/assets/princel/4.png' | relative_url }}",
            text: "Хорошо, я понял",
            type: "continue",
            next: "bad_ending"
        },
        "success": {
            image: "{{ '/assets/princel/5.png' | relative_url }}",
            text: "Э?",
            type: "continue",
            next: "06"
        },
        "bad_ending": {
            image: "",
            text: "...",
            type: "continue"
        },
        "06": {
            image: "{{ '/assets/princel/2.png' | relative_url }}",
            text: "Не знаю, что ты собирался этим сказать, но давай так",
            type: "continue",
            next: "07"
        },
        "07": {
            image: "{{ '/assets/princel/1.png' | relative_url }}",
            text: "Если хочешь, можешь приходить. Мне иногда бывает скучно",
            type: "continue",
            next: "08"
        },
        "08": {
            image: "{{ '/assets/princel/4.png' | relative_url }}",
            text: "А взамен я... Не знаю... Буду рассказывать секреты",
            type: "continue",
            next: "09"
        },
        "09": {
            image: "{{ '/assets/princel/2.png' | relative_url }}",
            text: "Этот сайт такой дырявый, что я тут поселился. Я могу подглядеть, что там внутри",
            type: "continue",
            next: "10"
        },
        "10": {
            image: "{{ '/assets/princel/2.png' | relative_url }}",
            text: "Хочешь секрет?",
            type: "choice",
            choices: [
                { text: "Хочу!", next: "11" },
                { text: "Нет", next: "wrong" }
            ]
        },
        "11": {
            image: "{{ '/assets/princel/2.png' | relative_url }}",
            text: "Если ввести какие-то буквы в основном окне, то откроется пасхался. что-то про какой-то шанс и компанию? не знаю",
            type: "continue",
            next: "12"
        },
        "12": {
            image: "{{ '/assets/princel/1.png' | relative_url }}",
            text: "Всё, а теперь иди",
            type: "continue",
            next: "13"
        },
        "13": {
            image: "{{ '/assets/princel/4.png' | relative_url }}",
            text: "...",
            type: "continue"
        }
    };

    // ОСНОВНАЯ ФУНКЦИЯ - ВСЯ ЛОГИКА ОТОБРАЖЕНИЯ
    function showStep(stepId) {
        const step = questData[stepId];
        if (!step) return;

        // Обновляем картинку и текст
        document.getElementById('quest-image').src = step.image;
        typeText(document.getElementById('quest-text'), step.text, 10);

        const area = document.getElementById('interaction-area');
        area.innerHTML = ''; // Очищаем

        if (step.type === "continue") {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = '→';
            btn.onclick = () => showStep(step.next);
            area.appendChild(btn);
        }
        else if (step.type === "choice") {
            step.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'btn choice-btn';
                btn.textContent = choice.text;
                btn.onclick = () => showStep(choice.next);
                area.appendChild(btn);
            });
        }
        else if (step.type === "input") {
            const container = document.createElement('div');
            container.className = 'input-area';

            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'text-input';
            input.placeholder = '...';

            const btn = document.createElement('button');
            btn.className = 'input-btn';
            btn.textContent = 'Отправить';
            btn.onclick = () => {
                const userAnswer = input.value.trim().toLowerCase();
                const nextStep = (userAnswer === step.answer) ? step.correctNext : step.wrongNext;
                showStep(nextStep);
            };

            // Отправка по Enter
            input.onkeypress = (e) => {
                if (e.key === 'Enter') btn.click();
            };

            container.appendChild(input);
            container.appendChild(btn);
            area.appendChild(container);
            input.focus();
        }
    }

    // Запускаем квест
    document.addEventListener('DOMContentLoaded', () => showStep("start"));

    function typeText(element, text, speed = 30) {
        let i = 0;
        element.textContent = '';

        function typeChar() {
            if (i < text.length) {
                element.textContent += text.charAt(i);
                i++;
                setTimeout(typeChar, speed);
            }
        }

        typeChar();
    }
</script>